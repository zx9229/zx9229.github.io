<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>OpenTSDB试玩环境搭建步骤 | zx9229.github.io</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="安装 Java 8, HBase, Zookeeper, OpenTSDB 的操作步骤。">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenTSDB试玩环境搭建步骤">
<meta property="og:url" content="http://zx9229.github.io/2018/08/17/OpenTSDB试玩环境搭建步骤/index.html">
<meta property="og:site_name" content="zx9229.github.io">
<meta property="og:description" content="安装 Java 8, HBase, Zookeeper, OpenTSDB 的操作步骤。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-17T03:38:40.327Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenTSDB试玩环境搭建步骤">
<meta name="twitter:description" content="安装 Java 8, HBase, Zookeeper, OpenTSDB 的操作步骤。">
  
    <link rel="alternate" href="/atom.xml" title="zx9229.github.io" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zx9229.github.io</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://zx9229.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-OpenTSDB试玩环境搭建步骤" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/17/OpenTSDB试玩环境搭建步骤/" class="article-date">
  <time datetime="2018-08-16T16:38:13.000Z" itemprop="datePublished">2018-08-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyDefaultCategory/">MyDefaultCategory</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      OpenTSDB试玩环境搭建步骤
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
          <div id="toc" class="toc-article">
            <strong class="toc-title">文章目录</strong>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Java-8"><span class="toc-number">1.</span> <span class="toc-text">安装 Java 8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-HBase"><span class="toc-number">2.</span> <span class="toc-text">安装 HBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Zookeeper"><span class="toc-number">3.</span> <span class="toc-text">安装 Zookeeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-OpenTSDB"><span class="toc-number">4.</span> <span class="toc-text">安装 OpenTSDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">5.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-metric"><span class="toc-number">5.1.</span> <span class="toc-text">创建 metric</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用-telnet-上报数据"><span class="toc-number">5.2.</span> <span class="toc-text">用 telnet 上报数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用-HTTP-的-API-上报数据"><span class="toc-number">5.3.</span> <span class="toc-text">用 HTTP 的 API 上报数据</span></a></li></ol></li></ol>
          </div>
        
        <p>安装 Java 8, HBase, Zookeeper, OpenTSDB 的操作步骤。</p>
<a id="more"></a>
<p>此文参考了以下链接：<br><a href="https://blog.csdn.net/u012842205/article/details/72817966" target="_blank" rel="noopener">OpenTSDB2.3.0安装部署</a>。<br><a href="https://www.jianshu.com/p/ba8f6e733886" target="_blank" rel="noopener">opentsdb+hbase的安装部署</a>。<br><a href="https://blog.csdn.net/liu16659/article/details/81038756" target="_blank" rel="noopener">openTSDB的安装与部署</a>。<br><a href="https://blog.csdn.net/liuxiao723846/article/details/52351919" target="_blank" rel="noopener">OpenTSDB安装与使用</a>。  </p>
<p>从<code>OpenTSDB 2.3 documentation</code>可以知道OpenTSDB依赖了HBase和Zookeeper。  </p>
<h3 id="安装-Java-8"><a href="#安装-Java-8" class="headerlink" title="安装 Java 8"></a>安装 Java 8</h3><p>目前(2018-08)，最新版的 HBase 和 OpenTSDB 需要 Java 8 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk-devel ( 运行 HBase 需要 java, 编译 OpenTSDB 需要 javac )</span><br></pre></td></tr></table></figure></p>
<p>然后<code>find / -type f -name java</code>就知道java安装到哪里去了。<br><code>find / \( -path /dev -o -path /mnt/hgfs \) -prune -o -type f -name java -print</code>。<br>在<code>/</code>下面(不包含<code>/dev</code>和<code>/mnt/hgfs</code>路径)寻找(类型是”文件”)的(“名字”是<code>java</code>)的文件。<br>我的安装在了<code>/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.181-3.b13.el6_10.x86_64/bin/java</code><br>执行<code>vi ~/.bash_profile</code>并在最后添加<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.181-3.b13.el6_10.x86_64</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure></p>
<p>并执行<code>source ~/.bash_profile</code>让设置生效。</p>
<h3 id="安装-HBase"><a href="#安装-HBase" class="headerlink" title="安装 HBase"></a>安装 HBase</h3><p><a href="https://hbase.apache.org/" target="_blank" rel="noopener">Apache HBase – Apache HBase™ Home</a>。<br><a href="http://mirrors.tuna.tsinghua.edu.cn/apache/hbase/2.1.0/hbase-2.1.0-bin.tar.gz" target="_blank" rel="noopener">hbase-2.1.0-bin.tar.gz</a>。<br><a href="https://hbase.apache.org/book.html" target="_blank" rel="noopener">Apache HBase ™ Reference Guide</a>。<br><a href="https://www.yiibai.com/hbase/hbase_installation.html" target="_blank" rel="noopener">HBase安装 - HBase教程™</a>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/mytest</span><br><span class="line">cp ./hbase-2.1.0-bin.tar.gz /opt/mytest</span><br><span class="line">tar -xf /opt/mytest/hbase-2.1.0-bin.tar.gz -C /opt/mytest</span><br></pre></td></tr></table></figure></p>
<p>执行<code>vi ~/.bash_profile</code>并在最后添加<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HBASE_HOME=/opt/mytest/hbase-2.1.0</span><br><span class="line">PATH=$PATH:$HBASE_HOME/bin</span><br><span class="line">export HBASE_HOME</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure></p>
<p>并执行<code>source ~/.bash_profile</code>让设置生效。<br>打开<code>/opt/mytest/hbase-2.1.0//conf/hbase-site.xml</code>文件，在<code>configuration</code>中配置如下内容（略，可选）。  </p>
<h3 id="安装-Zookeeper"><a href="#安装-Zookeeper" class="headerlink" title="安装 Zookeeper"></a>安装 Zookeeper</h3><p><a href="https://www.w3cschool.cn/zookeeper/zookeeper_installation.html" target="_blank" rel="noopener">Zookeeper 安装_w3cschool</a>。<br><a href="http://zookeeper.apache.org/releases.html" target="_blank" rel="noopener">Apache ZooKeeper - Releases</a>。<br><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/zookeeper-3.4.12.tar.gz" target="_blank" rel="noopener">zookeeper-3.4.12.tar.gz</a>。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp ./zookeeper-3.4.12.tar.gz /opt/mytest</span><br><span class="line">cd /opt/mytest</span><br><span class="line">tar -xf zookeeper-3.4.12.tar.gz</span><br><span class="line">cd zookeeper-3.4.12</span><br><span class="line">cp /opt/mytest/zookeeper-3.4.12/conf/zoo_sample.cfg /opt/mytest/zookeeper-3.4.12/conf/zoo.cfg</span><br><span class="line"><span class="meta">#</span> 视情况修改 conf/zoo.cfg 文件</span><br></pre></td></tr></table></figure></p>
<h3 id="安装-OpenTSDB"><a href="#安装-OpenTSDB" class="headerlink" title="安装 OpenTSDB"></a>安装 OpenTSDB</h3><p><a href="http://opentsdb.net/" target="_blank" rel="noopener">OpenTSDB - A Distributed, Scalable Monitoring System</a>。<br><a href="https://github.com/OpenTSDB/opentsdb/releases/download/v2.3.1/opentsdb-2.3.1.tar.gz" target="_blank" rel="noopener">opentsdb-2.3.1.tar.gz</a>。<br><a href="http://opentsdb.net/docs/build/html/installation.html" target="_blank" rel="noopener">Installation — OpenTSDB 2.3 documentation</a>。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yum install gnuplot automake autoconf  # (源码编译需要Java,GnuPlot,Autotools,Make,Python,Git)</span><br><span class="line">cp ./opentsdb-2.3.1.tar.gz /opt/mytest</span><br><span class="line">cd /opt/mytest</span><br><span class="line">tar -xf opentsdb-2.3.1.tar.gz</span><br><span class="line">cd opentsdb-2.3.1</span><br><span class="line">./build.sh</span><br><span class="line">cp -r ./third_party/ ./build</span><br><span class="line">./build.sh</span><br><span class="line"><span class="meta">#</span> 此时应当编译成功了</span><br><span class="line"><span class="meta">#</span> env COMPRESSION=NONE HBASE_HOME=/opt/mytest/hbase-2.1.0 ./src/create_table.sh</span><br><span class="line">env COMPRESSION=NONE ./src/create_table.sh</span><br><span class="line">mkdir -p /tmp/tsd</span><br><span class="line">./build/tsdb tsd --port=4242 --staticroot=./build/staticroot --cachedir=/tmp/tsd --zkquorum=localhost:2181</span><br><span class="line"><span class="meta">#</span>浏览器打开 http://127.0.0.1:4242</span><br></pre></td></tr></table></figure></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p><a href="http://opentsdb.net/docs/build/html/user_guide/index.html" target="_blank" rel="noopener">User Guide — OpenTSDB 2.3 documentation</a>。<br><a href="http://opentsdb.net/docs/build/html/user_guide/quickstart.html" target="_blank" rel="noopener">Quick Start — OpenTSDB 2.3 documentation</a>。<br><a href="http://opentsdb.net/docs/build/html/api_http/put.html" target="_blank" rel="noopener">/api/put — OpenTSDB 2.3 documentation</a>。  </p>
<h4 id="创建-metric"><a href="#创建-metric" class="headerlink" title="创建 metric"></a>创建 metric</h4><p>格式: <code>./tsdb mkmetric metric_name_1 metric_name_2 metric_name_n</code>。<br>示例: <code>./tsdb mkmetric mydata.cpu.1s mydata.cpu.5s mydata.cpu.1m</code>。<br>解释: <code>mydata.cpu.1s</code>和<code>mydata.cpu.5s</code>和<code>mydata.cpu.1m</code>的metric。</p>
<h4 id="用-telnet-上报数据"><a href="#用-telnet-上报数据" class="headerlink" title="用 telnet 上报数据"></a>用 telnet 上报数据</h4><p>格式: <code>put metric_name_1 Unix时间戳 value tagK1=tagV1 tagK2=tagV2 tagKn=tagVn</code>。<br>示例: <code>put mydata.cpu.1s 1514779200 0.6 host=machine1 collector=test_exe</code>。<br>解释: 上报的<code>metric</code>=<code>mydata.cpu.1s</code>，时间=<code>20180101-120000</code>，主机<code>host</code>=<code>machine1</code>，采集程序<code>collector</code>=<code>test_exe</code>。</p>
<h4 id="用-HTTP-的-API-上报数据"><a href="#用-HTTP-的-API-上报数据" class="headerlink" title="用 HTTP 的 API 上报数据"></a>用 HTTP 的 API 上报数据</h4><p><a href="http://opentsdb.net/docs/build/html/api_http/put.html" target="_blank" rel="noopener">/api/put — OpenTSDB 2.3 documentation</a>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -d &apos;</span><br><span class="line">&#123;&quot;metric&quot;:&quot;mydata.cpu.1s&quot;,</span><br><span class="line">  &quot;timestamp&quot;:1514779200,</span><br><span class="line">  &quot;value&quot;:0.6,</span><br><span class="line">  &quot;tags&quot;:&#123;</span><br><span class="line">    &quot;host&quot;:&quot;machine1&quot;,</span><br><span class="line">    &quot;collector&quot;:&quot;test_exe&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&apos; &quot;http://127.0.0.1:4242/api/put&quot;</span><br></pre></td></tr></table></figure></p>
<p>完。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zx9229.github.io/2018/08/17/OpenTSDB试玩环境搭建步骤/" data-id="cjlawzq9c000necpr1shhtofq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/08/22/Windows的netsh-interface-portproxy的一个例子/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Windows的netsh-interface-portproxy的一个例子
        
      </div>
    </a>
  
  
    <a href="/2018/08/06/golang的protobuf例子/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">golang的protobuf例子</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/shell/">shell</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyDefaultCategory/">MyDefaultCategory</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/powershell/">powershell</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/python/Ansible/">Ansible</a></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/25/InternetDownloadManager相关/">InternetDownloadManager相关</a>
          </li>
        
          <li>
            <a href="/2018/08/22/Windows的netsh-interface-portproxy的一个例子/">Windows的netsh-interface-portproxy的一个例子</a>
          </li>
        
          <li>
            <a href="/2018/08/17/OpenTSDB试玩环境搭建步骤/">OpenTSDB试玩环境搭建步骤</a>
          </li>
        
          <li>
            <a href="/2018/08/06/golang的protobuf例子/">golang的protobuf例子</a>
          </li>
        
          <li>
            <a href="/2018/07/23/Golang相关的收集贴/">Golang相关的收集贴</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 zx9229<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>